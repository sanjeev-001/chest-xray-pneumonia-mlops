<!DOCTYPE html>
<html>
<head>
    <title>Chest X-Ray Pneumonia Detection</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .upload-area { border: 2px dashed #ccc; padding: 40px; text-align: center; margin: 20px 0; }
        .result { margin: 20px 0; padding: 20px; background: #f5f5f5; border-radius: 5px; }
        button { padding: 10px 20px; font-size: 16px; cursor: pointer; }
        .prediction { font-size: 24px; font-weight: bold; margin: 10px 0; }
        .normal { color: green; }
        .pneumonia { color: red; }
    </style>
</head>
<body>
    <h1>Chest X-Ray Pneumonia Detection</h1>
    
    <div class="upload-area">
        <input type="file" id="imageInput" accept="image/*" />
        <p>Select a chest X-ray image</p>
        <button onclick="predictImage()">Predict</button>
    </div>
    
    <div id="result" class="result" style="display: none;">
        <h3>Prediction Result:</h3>
        <div id="prediction" class="prediction"></div>
        <div id="confidence"></div>
        <div id="probabilities"></div>
        <div id="rawOutputs"></div>
    </div>

    <script>
        async function predictImage() {
            const fileInput = document.getElementById('imageInput');
            const file = fileInput.files[0];
            
            if (!file) {
                alert('Please select an image first');
                return;
            }
            
            const formData = new FormData();
            formData.append('file', file);
            
            try {
                const response = await fetch('http://localhost:5000/predict', {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    displayResult(result);
                } else {
                    alert('Error: ' + result.error);
                }
            } catch (error) {
                alert('Error connecting to API: ' + error.message);
            }
        }
        
        function displayResult(result) {
            const resultDiv = document.getElementById('result');
            const predictionDiv = document.getElementById('prediction');
            const confidenceDiv = document.getElementById('confidence');
            const probabilitiesDiv = document.getElementById('probabilities');
            const rawOutputsDiv = document.getElementById('rawOutputs');
            
            // Set prediction with color
            predictionDiv.textContent = result.prediction;
            predictionDiv.className = 'prediction ' + (result.prediction === 'NORMAL' ? 'normal' : 'pneumonia');
            
            // Set confidence
            confidenceDiv.innerHTML = `<strong>Confidence:</strong> ${(result.confidence * 100).toFixed(2)}%`;
            
            // Set probabilities
            let probText = '<strong>Probabilities:</strong><br>';
            for (const [className, prob] of Object.entries(result.probabilities)) {
                probText += `${className}: ${(prob * 100).toFixed(2)}%<br>`;
            }
            probabilitiesDiv.innerHTML = probText;
            
            // Set raw outputs
            rawOutputsDiv.innerHTML = `<strong>Raw Outputs:</strong> [${result.raw_outputs[0].map(x => x.toFixed(4)).join(', ')}]`;
            
            resultDiv.style.display = 'block';
        }
    </script>
</body>
</html>